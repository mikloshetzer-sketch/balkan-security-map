name: WordPress weekly post (map + summary)

on:
  schedule:
    - cron: "30 6 * * 1"   # hétfő 07:30 Budapest (UTC+1/2)
  workflow_dispatch:

jobs:
  post_weekly:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Build weekly content
        run: |
          cat > post.html << 'EOF'
          <h2>Balkán biztonsági helyzet – heti összefoglaló</h2>

          <p>Automatikus heti kivonat a térképes rendszer alapján.</p>

          <h3>Fő trendek</h3>
          <ul>
            <li>hotspot koncentráció változása</li>
            <li>korai jelzések alakulása</li>
            <li>GDACS / USGS események</li>
          </ul>

          <h3>Interaktív térkép</h3>

          <iframe
            src="https://mikloshetzer-sketch.github.io/balkan-security-map/"
            width="100%"
            height="650"
            style="border:0;border-radius:12px;">
          </iframe>

          <p style="margin-top:12px;font-size:12px;color:#666;">
          Forrás: Balkán biztonsági monitor – automatikus rendszer
          </p>
          EOF

      - name: Publish to WordPress
        env:
          WP_ACCESS_TOKEN: ${{ secrets.WP_ACCESS_TOKEN }}
          WP_BLOG_ID: ${{ secrets.WP_BLOG_ID }}
        run: |
          curl -X POST "https://public-api.wordpress.com/rest/v1.1/sites/${WP_BLOG_ID}/posts/new" \
            -H "Authorization: Bearer ${WP_ACCESS_TOKEN}" \
            -d title="Balkán biztonsági monitor – heti jelentés" \
            -d content@post.html \
            -d status=publish
